<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firemné financie</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    header { display: flex; align-items: center; justify-content: space-between; }
    header img { height: 50px; }
    h1 { text-align: center; flex-grow: 1; margin: 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eaeaea; }
    input[type="text"], input[type="number"], input[type="date"] {
      width: 100%; padding: 6px; box-sizing: border-box;
    }
    .controls { margin-top: 20px; text-align: center; }
    button { padding: 10px 15px; margin: 5px; }
    #month-select { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; }
    #month-select button { margin: 2px; }
  </style>
</head>
<body>
  <header>
    <img src="./icons/logo.png" alt="Logo firmy">
    <h1>Firemné financie - mesačný prehľad</h1>
    <div style="width: 50px"></div>
  </header>

  <div id="month-select">
    <button onclick="setMonth('Január')">Január</button>
    <button onclick="setMonth('Február')">Február</button>
    <button onclick="setMonth('Marec')">Marec</button>
    <button onclick="setMonth('Apríl')">Apríl</button>
    <button onclick="setMonth('Máj')">Máj</button>
    <button onclick="setMonth('Jún')">Jún</button>
    <button onclick="setMonth('Júl')">Júl</button>
    <button onclick="setMonth('August')">August</button>
    <button onclick="setMonth('September')">September</button>
    <button onclick="setMonth('Október')">Október</button>
    <button onclick="setMonth('November')">November</button>
    <button onclick="setMonth('December')">December</button>
  </div>

  <table id="finance-table">
    <thead>
      <tr>
        <th>Dátum</th>
        <th>Zákazník / Projekt</th>
        <th>Príjem (€)</th>
        <th>Výdavok (€)</th>
        <th>Zisk</th>
        <th>Poznámka</th>
      </tr>
    </thead>
    <tbody id="finance-body">
    </tbody>
    <tfoot>
      <tr>
        <th colspan="2">Spolu</th>
        <th id="sum-prijem"></th>
        <th id="sum-vydavok"></th>
        <th id="sum-zisk"></th>
        <th></th>
      </tr>
    </tfoot>
  </table>

  <div class="controls">
    <button onclick="addRow()">Pridať záznam</button>
    <button onclick="generatePDF()">Vygenerovať PDF</button>
    <button onclick="saveAsJSON()">Uložiť na disk (Google)</button>
  </div>

  <script>
    function addRow() {
      const tbody = document.getElementById("finance-body");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="date"></td>
        <td><input type="text"></td>
        <td><input type="number" step="0.01" oninput="recalculate()"></td>
        <td><input type="number" step="0.01" oninput="recalculate()"></td>
        <td class="zisk">0.00</td>
        <td><input type="text"></td>
      `;
      tbody.appendChild(row);
    }

    function recalculate() {
      let sumPrijem = 0, sumVydavok = 0, sumZisk = 0;
      const rows = document.querySelectorAll("#finance-body tr");
      rows.forEach(row => {
        const prijem = parseFloat(row.children[2].querySelector("input")?.value || 0);
        const vydavok = parseFloat(row.children[3].querySelector("input")?.value || 0);
        const zisk = prijem - vydavok;
        row.children[4].innerText = zisk.toFixed(2);
        sumPrijem += prijem;
        sumVydavok += vydavok;
        sumZisk += zisk;
      });
      document.getElementById("sum-prijem").innerText = sumPrijem.toFixed(2);
      document.getElementById("sum-vydavok").innerText = sumVydavok.toFixed(2);
      document.getElementById("sum-zisk").innerText = sumZisk.toFixed(2);
    }

    function generatePDF() {
      alert("Export do PDF bude doplnený cez jsPDF alebo html2pdf.");
    }

    function setMonth(mesiac) {
      alert("Zobrazuješ dáta za mesiac: " + mesiac);
    }

    function saveAsJSON() {
      const data = [];
      document.querySelectorAll("#finance-body tr").forEach(row => {
        const cells = row.querySelectorAll("td");
        const datum = cells[0].querySelector("input")?.value || "";
        const projekt = cells[1].querySelector("input")?.value || "";
        const prijem = parseFloat(cells[2].querySelector("input")?.value || 0);
        const vydavok = parseFloat(cells[3].querySelector("input")?.value || 0);
        const zisk = prijem - vydavok;
        const poznamka = cells[5].querySelector("input")?.value || "";
        data.push({ datum, projekt, prijem, vydavok, zisk, poznamka });
      });
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "firemne_financie.json";
      a.click();
    }
  </script>
</body>
</html>
